<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bondhu - Mental Health Monitoring System</title>
    <style>
        /* ADD THIS CSS FOR MODAL VISIBILITY */
        #crud-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .modal-content h3 {
            margin-top: 0;
            color: #333;
            font-size: 20px;
            margin-bottom: 20px;
        }
        
        .modal-content input,
        .modal-content textarea,
        .modal-content select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 14px;
        }
        
        .modal-content label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-primary {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ===== LOGIN PAGE ===== -->
    <div id="login-page" class="page">
        <div class="login-container">
            <div class="login-box">
                <div class="logo">
                    <svg width="50" height="50" viewBox="0 0 50 50" fill="none">
                        <circle cx="25" cy="25" r="20" stroke="#D946EF" stroke-width="2"/>
                        <path d="M25 15V35M15 25H35" stroke="#D946EF" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </div>
                <h1>Welcome to <span>Bondhu</span></h1>
                <p class="tagline">Your friend for mental wellness</p>
                
                <div class="role-selector">
                    <p class="role-label">Sign in as:</p>
                    <div class="role-buttons">
                        <button class="role-btn" data-role="patient">PATIENT</button>
                        <button class="role-btn" data-role="counselor">COUNSELOR</button>
                        <button class="role-btn" data-role="admin">ADMIN</button>
                        <button class="role-btn" data-role="pharmacist">PHARMACIST</button>
                        <button class="role-btn" data-role="finance">FINANCE</button>
                    </div>
                </div>

                <form id="login-form" class="login-form">
                    <input type="email" id="email" placeholder="Enter your email" required>
                    <input type="password" id="password" placeholder="Enter your password" required>
                    <button type="submit" class="login-btn"><span id="login-btn-text">Sign in</span></button>
                </form>
            </div>
        </div>
    </div>

    <!-- ===== MAIN DASHBOARD PAGE ===== -->
    <div id="dashboard-page" class="page" style="display: none;">
        <div class="dashboard-container">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <div class="logo-text">
                        <svg width="30" height="30" viewBox="0 0 50 50" fill="none">
                            <circle cx="25" cy="25" r="20" stroke="#D946EF" stroke-width="2"/>
                            <path d="M25 15V35M15 25H35" stroke="#D946EF" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span>Bondhu</span>
                    </div>
                </div>
                <div class="header-right">
                    <span id="user-greeting">Welcome, User</span>
                    <div class="user-avatar">üë§</div>
                    <button id="logout-btn" class="logout-btn">Logout</button>
                </div>
            </header>

            <!-- Sidebar Navigation -->
            <aside class="sidebar">
                <nav class="nav-menu">
                    <!-- PATIENT FEATURES -->
                    <button class="nav-item active" data-page="dashboard">
                        <span class="icon">üìä</span>
                        <span>Dashboard</span>
                    </button>
                    <button class="nav-item" data-page="daily-log" style="display: none;">
                        <span class="icon">üìù</span>
                        <span>Daily Log</span>
                    </button>
                    <button class="nav-item" data-page="ai-analysis" style="display: none;">
                        <span class="icon">ü§ñ</span>
                        <span>AI Analysis & Q&A</span>
                    </button>
                    <button class="nav-item" data-page="recommendations" style="display: none;">
                        <span class="icon">‚ù§Ô∏è</span>
                        <span>Recommendations</span>
                    </button>
                    <button class="nav-item" data-page="counseling" style="display: none;">
                        <span class="icon">üë®‚Äç‚öïÔ∏è</span>
                        <span>Counseling</span>
                    </button>
                    <button class="nav-item" data-page="progress" style="display: none;">
                        <span class="icon">üìà</span>
                        <span>Progress</span>
                    </button>
                    <button class="nav-item" data-page="pharmacy" style="display: none;">
                        <span class="icon">üíä</span>
                        <span>Pharmacy</span>
                    </button>
                    <button class="nav-item" data-page="crisis-support" style="display: none;">
                        <span class="icon">‚ö†Ô∏è</span>
                        <span>Crisis Support</span>
                    </button>

                    <!-- COUNSELOR FEATURES -->
                    <button class="nav-item" data-page="counselor-sessions" style="display: none;">
                        <span class="icon">üë®‚Äç‚öïÔ∏è</span>
                        <span>Session Management</span>
                    </button>
                    

                    <!-- ADMIN FEATURES -->
                    <button class="nav-item" data-page="user-management" style="display: none;">
                        <span class="icon">üë•</span>
                        <span>User Management</span>
                    </button>
                    <button class="nav-item" data-page="manage-counselors" style="display: none;">
                        <span class="icon">üë®‚Äç‚öïÔ∏è</span>
                        <span>Manage Counselors</span>
                    </button>
                    <button class="nav-item" data-page="all-sessions" style="display: none;">
                        <span class="icon">üìÖ</span>
                        <span>All Sessions</span>
                    </button>
                    <button class="nav-item" data-page="all-daily-logs" style="display: none;">
                        <span class="icon">üìù</span>
                        <span>All Daily Logs</span>
                    </button>
                    <button class="nav-item" data-page="ai-analysis-log" style="display: none;">
                        <span class="icon">ü§ñ</span>
                        <span>AI Analysis Log</span>
                    </button>
                    <button class="nav-item" data-page="content" style="display: none;">
                        <span class="icon">üìÑ</span>
                        <span>Content</span>
                    </button>
                    <button class="nav-item" data-page="crisis-log" style="display: none;">
                        <span class="icon">üö®</span>
                        <span>Crisis Log</span>
                    </button>

                    <!-- PHARMACIST FEATURES -->
                    <button class="nav-item" data-page="prescription-queue" style="display: none;">
                        <span class="icon">üíä</span>
                        <span>Prescription Queue</span>
                    </button>

                    <!-- FINANCE FEATURES -->
                    <button class="nav-item" data-page="billing-dashboard" style="display: none;">
                        <span class="icon">üí≥</span>
                        <span>Billing Dashboard</span>
                    </button>
                </nav>
                <button id="logout-btn-sidebar" class="logout-btn-sidebar" style="display: none;">Logout</button>
            </aside>

            <!-- Main Content Area -->
            <main class="main-content">
                <!-- DASHBOARD SECTION -->
                <div id="dashboard" class="content-section active">
                    <h2>Dashboard</h2>
                    
                    <!-- PATIENT DASHBOARD -->
                     <!-- PATIENT DASHBOARD - ENHANCED -->
                        <div id="patient-dashboard">
                            <!-- Welcome Card -->
                            <div style="background: linear-gradient(135deg, rgba(217, 70, 239, 0.15) 0%, rgba(6, 182, 212, 0.15) 100%); border: 1px solid var(--dark-border); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h3 style="color: var(--text-primary); margin-bottom: 8px;">Welcome back, <span id="patient-name">Alex</span>! üëã</h3>
                                        <p style="color: var(--text-secondary);">Here's your mental health overview for today</p>
                                    </div>
                                    <button class="add-btn" onclick="logToday()" style="background: var(--success);">
                                        üìù Log Today's Mood
                                    </button>
                                </div>
                            </div>

                            <!-- Stats Grid with Icons -->
                            <div class="stats-grid">
                                <div class="stat-card" style="border-left: 4px solid #D946EF;">
                                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                        <div style="background: rgba(217, 70, 239, 0.1); width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                            <span style="font-size: 20px;">üòä</span>
                                        </div>
                                        <div>
                                            <p class="stat-label">MOOD TREND</p>
                                            <p class="stat-value">4.1 / 5</p>
                                        </div>
                                    </div>
                                    <p style="color: var(--text-secondary); font-size: 12px; margin-top: 8px;">
                                        <span style="color: #10B981;">‚Üë 12%</span> better than last week
                                    </p>
                                </div>
                                
                                <div class="stat-card" style="border-left: 4px solid #EF4444;">
                                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                        <div style="background: rgba(239, 68, 68, 0.1); width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                            <span style="font-size: 20px;">üò∞</span>
                                        </div>
                                        <div>
                                            <p class="stat-label">STRESS LEVEL</p>
                                            <p class="stat-value">2.8 / 5</p>
                                        </div>
                                    </div>
                                    <p style="color: var(--text-secondary); font-size: 12px; margin-top: 8px;">
                                        <span style="color: #10B981;">‚Üì 8%</span> from last week
                                    </p>
                                </div>
                                
                                <div class="stat-card" style="border-left: 4px solid #06B6D4;">
                                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                        <div style="background: rgba(6, 182, 212, 0.1); width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                            <span style="font-size: 20px;">üò¥</span>
                                        </div>
                                        <div>
                                            <p class="stat-label">SLEEP QUALITY</p>
                                            <p class="stat-value">7.6 hrs</p>
                                        </div>
                                    </div>
                                    <p style="color: var(--text-secondary); font-size: 12px; margin-top: 8px;">
                                        <span style="color: #EF4444;">‚Üì 0.4 hrs</span> from target
                                    </p>
                                </div>
                                
                                <div class="stat-card highlight" style="border-left: 4px solid #10B981;">
                                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                        <div style="background: rgba(16, 185, 129, 0.1); width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                            <span style="font-size: 20px;">ü§ñ</span>
                                        </div>
                                        <div>
                                            <p class="stat-label">AI WELLNESS SCORE</p>
                                            <p class="stat-value">82 / 100</p>
                                        </div>
                                    </div>
                                    <p style="color: var(--text-secondary); font-size: 12px; margin-top: 8px;">
                                        <span style="color: #10B981;">‚Üë 5 points</span> this month
                                    </p>
                                </div>
                            </div>

                            <!-- Charts and Quick Actions -->
                            <div class="charts-grid" style="margin-top: 24px;">
                                <!-- Mood Chart -->
                                <div class="chart-card">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                        <h3>üìà Mood Tracker (Last 7 Days)</h3>
                                        <select style="background: var(--dark-bg); color: var(--text-primary); border: 1px solid var(--dark-border); padding: 6px 12px; border-radius: 6px; font-size: 12px;">
                                            <option>Last 7 days</option>
                                            <option>Last 30 days</option>
                                            <option>Last 3 months</option>
                                        </select>
                                    </div>
                                    <div style="display: flex; align-items: flex-end; height: 200px; gap: 12px; padding: 20px 0;">
                                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                            <div style="background: linear-gradient(to top, #D946EF, #E879F9); width: 100%; height: 120px; border-radius: 4px;"></div>
                                            <p style="color: var(--text-secondary); font-size: 12px; margin-top: 8px;">Mon</p>
                                        </div>
                                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                            <div style="background: linear-gradient(to top, #D946EF, #E879F9); width: 100%; height: 80px; border-radius: 4px;"></div>
                                            <p style="color: var(--text-secondary); font-size: 12px; margin-top: 8px;">Tue</p>
                                        </div>
                                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                            <div style="background: linear-gradient(to top, #D946EF, #E879F9); width: 100%; height: 150px; border-radius: 4px;"></div>
                                            <p style="color: var(--text-secondary); font-size: 12px; margin-top: 8px;">Wed</p>
                                        </div>
                                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                            <div style="background: linear-gradient(to top, #D946EF, #E879F9); width: 100%; height: 100px; border-radius: 4px;"></div>
                                            <p style="color: var(--text-secondary); font-size: 12px; margin-top: 8px;">Thu</p>
                                        </div>
                                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                            <div style="background: linear-gradient(to top, #D946EF, #E879F9); width: 100%; height: 60px; border-radius: 4px;"></div>
                                            <p style="color: var(--text-secondary); font-size: 12px; margin-top: 8px;">Fri</p>
                                        </div>
                                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                            <div style="background: linear-gradient(to top, #D946EF, #E879F9); width: 100%; height: 140px; border-radius: 4px;"></div>
                                            <p style="color: var(--text-secondary); font-size: 12px; margin-top: 8px;">Sat</p>
                                        </div>
                                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                            <div style="background: linear-gradient(to top, #D946EF, #E879F9); width: 100%; height: 90px; border-radius: 4px;"></div>
                                            <p style="color: var(--text-secondary); font-size: 12px; margin-top: 8px;">Sun</p>
                                        </div>
                                    </div>
                                    <p style="text-align: center; color: var(--text-secondary); font-size: 12px; margin-top: 10px;">Higher bars = Better mood</p>
                                </div>

                                <!-- Quick Actions -->
                                <div class="chart-card">
                                    <h3>‚ö° Quick Actions</h3>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px;">
                                        <button class="quick-action" onclick="navigateTo('daily-log')">
                                            <span style="font-size: 24px; margin-bottom: 8px;">üìù</span>
                                            <span style="font-weight: 600; font-size: 13px;">Log Mood</span>
                                            <span style="color: var(--text-secondary); font-size: 11px;">Daily check-in</span>
                                        </button>
                                        <button class="quick-action" onclick="navigateTo('ai-analysis')">
                                            <span style="font-size: 24px; margin-bottom: 8px;">ü§ñ</span>
                                            <span style="font-weight: 600; font-size: 13px;">AI Analysis</span>
                                            <span style="color: var(--text-secondary); font-size: 11px;">Journal review</span>
                                        </button>
                                        <button class="quick-action" onclick="navigateTo('recommendations')">
                                            <span style="font-size: 24px; margin-bottom: 8px;">‚ù§Ô∏è</span>
                                            <span style="font-weight: 600; font-size: 13px;">Activities</span>
                                            <span style="color: var(--text-secondary); font-size: 11px;">Guided exercises</span>
                                        </button>
                                        <button class="quick-action" onclick="navigateTo('counseling')">
                                            <span style="font-size: 24px; margin-bottom: 8px;">üë®‚Äç‚öïÔ∏è</span>
                                            <span style="font-weight: 600; font-size: 13px;">Book Session</span>
                                            <span style="color: var(--text-secondary); font-size: 11px;">Talk to counselor</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Daily Reminder -->
                                    <div style="background: var(--dark-bg); border-radius: 8px; padding: 16px; margin-top: 20px;">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <div style="background: rgba(217, 70, 239, 0.1); width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                                <span>üîî</span>
                                            </div>
                                            <div>
                                                <p style="color: var(--text-primary); font-weight: 600; font-size: 13px;">Daily Reminder</p>
                                                <p style="color: var(--text-secondary); font-size: 12px;">Time for your evening mood check</p>
                                            </div>
                                        </div>
                                        <button class="save-btn" style="width: 100%; margin-top: 12px; padding: 8px;" onclick="logToday()">
                                            Do It Now
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Activity -->
                            <div class="chart-card" style="margin-top: 24px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                    <h3>üìã Recent Activity</h3>
                                    <button class="add-btn" onclick="navigateTo('daily-log')" style="padding: 6px 12px; font-size: 12px;">
                                        View All
                                    </button>
                                </div>
                                <table style="width: 100%;">
                                    <thead>
                                        <tr>
                                            <th style="text-align: left; padding: 10px 0; color: var(--text-secondary); font-size: 12px;">TIME</th>
                                            <th style="text-align: left; padding: 10px 0; color: var(--text-secondary); font-size: 12px;">ACTIVITY</th>
                                            <th style="text-align: left; padding: 10px 0; color: var(--text-secondary); font-size: 12px;">STATUS</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr style="border-bottom: 1px solid var(--dark-border);">
                                            <td style="padding: 12px 0; color: var(--text-primary); font-size: 13px;">Today, 9:00 AM</td>
                                            <td style="padding: 12px 0; color: var(--text-primary); font-size: 13px;">Morning mood log</td>
                                            <td style="padding: 12px 0;"><span style="background: rgba(16, 185, 129, 0.15); color: #10B981; padding: 4px 8px; border-radius: 4px; font-size: 11px;">Completed</span></td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid var(--dark-border);">
                                            <td style="padding: 12px 0; color: var(--text-primary); font-size: 13px;">Yesterday, 3:30 PM</td>
                                            <td style="padding: 12px 0; color: var(--text-primary); font-size: 13px;">AI journal analysis</td>
                                            <td style="padding: 12px 0;"><span style="background: rgba(16, 185, 129, 0.15); color: #10B981; padding: 4px 8px; border-radius: 4px; font-size: 11px;">Completed</span></td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid var(--dark-border);">
                                            <td style="padding: 12px 0; color: var(--text-primary); font-size: 13px;">Nov 18, 10:00 AM</td>
                                            <td style="padding: 12px 0; color: var(--text-primary); font-size: 13px;">Counseling session</td>
                                            <td style="padding: 12px 0;"><span style="background: rgba(16, 185, 129, 0.15); color: #10B981; padding: 4px 8px; border-radius: 4px; font-size: 11px;">Completed</span></td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 12px 0; color: var(--text-primary); font-size: 13px;">Nov 17, 7:00 PM</td>
                                            <td style="padding: 12px 0; color: var(--text-primary); font-size: 13px;">Evening meditation</td>
                                            <td style="padding: 12px 0;"><span style="background: rgba(239, 68, 68, 0.15); color: #EF4444; padding: 4px 8px; border-radius: 4px; font-size: 11px;">Missed</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    

                    <!-- ADMIN DASHBOARD -->
                    <div id="admin-dashboard" style="display: none;">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <p class="stat-label">Total Users</p>
                                <p class="stat-value">1,254</p>
                            </div>
                            <div class="stat-card">
                                <p class="stat-label">Active Counselors</p>
                                <p class="stat-value">12</p>
                            </div>
                            <div class="stat-card">
                                <p class="stat-label">Sessions this Week</p>
                                <p class="stat-value">88</p>
                            </div>
                            <div class="stat-card highlight" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%); border-color: #EF4444;">
                                <p class="stat-label">Crisis Alerts (24h)</p>
                                <p class="stat-value" style="background: linear-gradient(90deg, #EF4444 0%, #06B6D4 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">3</p>
                            </div>
                        </div>
                        <div class="system-health">
                            <div class="health-card">
                                <h3>System Health</h3>
                                <p>All systems operational.</p>
                            </div>
                        </div>
                    </div>

                    <!-- PHARMACIST DASHBOARD -->
                    <div id="pharmacist-dashboard" style="display: none;">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <p class="stat-label">Pending Prescriptions</p>
                                <p class="stat-value">24</p>
                            </div>
                            <div class="stat-card">
                                <p class="stat-label">Approved Today</p>
                                <p class="stat-value">18</p>
                            </div>
                            <div class="stat-card">
                                <p class="stat-label">Out for Delivery</p>
                                <p class="stat-value">12</p>
                            </div>
                            <div class="stat-card highlight">
                                <p class="stat-label">Delivered</p>
                                <p class="stat-value">156</p>
                            </div>
                        </div>
                    </div>

                    <!-- FINANCE DASHBOARD -->
                    <div id="finance-dashboard" style="display: none;">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <p class="stat-label">Revenue (Month)</p>
                                <p class="stat-value">$10,560</p>
                            </div>
                            <div class="stat-card highlight">
                                <p class="stat-label">Outstanding Invoices</p>
                                <p class="stat-value">$1,320</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ===== PATIENT - DAILY LOG ===== -->
                <div id="daily-log" class="content-section">
                    <h2>Daily Log</h2>
                    <div class="log-form">
                        <div class="form-section">
                            <label>How are you feeling today?</label>
                            <input type="range" min="1" max="5" value="3" class="mood-slider">
                            <span class="slider-value">üòä</span>
                        </div>
                        <div class="form-section">
                            <label>How stressed are you?</label>
                            <input type="range" min="1" max="5" value="3" class="stress-slider">
                            <span class="slider-value">3/5</span>
                        </div>
                        <div class="form-section">
                            <label>How many hours did you sleep?</label>
                            <input type="range" min="0" max="12" value="7" class="sleep-slider">
                            <span class="slider-value">7 hrs</span>
                        </div>
                        <div class="form-section">
                            <label>Any notes for today?</label>
                            <textarea placeholder="e.g., Had a great meeting at work..." rows="4"></textarea>
                        </div>
                        <button class="save-btn" onclick="saveDailyLog()">Save Log</button>
                    </div>
                    
                    <!-- DAILY LOGS TABLE - UPDATED TO MATCH DATABASE -->
                    <div class="log-history">
                        <div class="table-header">
                            <div class="table-title">Daily Logs</div>
                            <div class="header-controls">
                                <button class="add-btn" onclick="openAddModal('dailylogs')">+ Add New</button>
                                <input type="text" class="search-input" placeholder="Search..." onkeyup="searchTable('dailylogs', this.value)">
                            </div>
                        </div>
                        <div id="dailylogs-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>DailyLog_ID</th>
                                        <th>Patient_ID</th>  
                                        <th>Timestamp</th>
                                        <th>Mood</th>
                                        <th>StressLevel</th>
                                        <th>SleepHours</th>
                                        <th>Notes</th>
                                        <th>ACTIONS</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be loaded here from database -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- PATIENT TABLE - UPDATED TO MATCH DATABASE -->
                    <div class="log-history">
                        <div class="table-header">
                            <div class="table-title">Patients</div>
                            <div class="header-controls">
                                <button class="add-btn" onclick="openAddModal('patient')">+ Add New</button>
                                <input type="text" class="search-input" placeholder="Search..." onkeyup="searchTable('patient', this.value)">
                            </div>
                        </div>
                        <div id="patient-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Patient_ID</th>
                                        <th>Name</th>  
                                        <th>Age</th>
                                        <th>Gender</th>
                                        <th>Contact</th>
                                        <th>Address</th>
                                        <th>Email</th>
                                        <th>Emergency Contact</th>
                                        <th>ACTIONS</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be loaded here from database -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ===== PATIENT - AI ANALYSIS ===== -->
                <div id="ai-analysis" class="content-section">
                    <h2>AI Mood Analysis & Q&A</h2>
                    
                    <!-- Journal Analysis Section -->
                    <div class="log-form" style="margin-bottom: 30px;">
                        <div class="form-section">
                            <label><strong>Journal Entry Analysis (AI-Powered)</strong></label>
                            <textarea id="journal-entry" placeholder="Write about your day, thoughts, feelings... AI will analyze emotions and provide insights..." rows="5"></textarea>
                        </div>
                        <button onclick="analyzeJournal()" class="save-btn">Analyze with AI</button>
                        <div id="ai-results" style="margin-top: 20px; display: none;">
                            <div class="insight-card">
                                <p><strong>ü§ñ AI Analysis Results:</strong></p>
                                <p>üìä <strong>Emotion Detected:</strong> <span id="detected-emotion">Neutral</span></p>
                                <p>‚ö†Ô∏è <strong>Risk Score:</strong> <span id="risk-score">Low (15/100)</span></p>
                                <p>üîç <strong>Keywords Found:</strong> <span id="keywords">work, stress, tired</span></p>
                                <p>üí° <strong>AI Insight:</strong> <span id="ai-insight">Your writing shows signs of work-related stress. Consider taking short breaks.</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- AI Chat Assistant -->
                    <div class="ai-section">
                        <div class="ai-insights">
                            <h3>AI Mental Health Assistant (Q&A)</h3>
                            <div class="chat-container" style="background: var(--dark-bg); border-radius: 8px; padding: 15px; height: 250px; overflow-y: auto; margin-bottom: 15px;">
                                <div class="chat-message ai" style="background: rgba(6, 182, 212, 0.1); padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                                    <strong>AI Assistant:</strong> Hello! I'm your mental health assistant. You can ask me about anxiety, stress management, sleep issues, or anything related to mental wellness.
                                </div>
                            </div>
                            <div class="qa-input">
                                <input type="text" id="user-question" placeholder="e.g., How to manage anxiety at work?" style="flex: 1;">
                                <button onclick="askAI()" class="save-btn" style="padding: 10px 20px;">Ask AI</button>
                            </div>
                        </div>
                        
                        <!-- AI ANALYSIS TABLE - UPDATED TO MATCH DATABASE -->
                        <div class="qa-section">
                            <h3>AI Analysis Log</h3>
                            <div class="table-header">
                                <div class="table-title"></div>
                                <div class="header-controls">
                                    <button class="add-btn" onclick="openAddModal('aianalysis')">+ Add New</button>
                                    <input type="text" class="search-input" placeholder="Search analysis..." onkeyup="searchTable('aianalysis', this.value)">
                                </div>
                            </div>
                            <div id="aianalysis-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Analysis_ID</th>
                                            <th>Patient_ID</th>
                                            <th>SentimentScore</th>
                                            <th>RiskScore</th>
                                            <th>EmotionClassification</th>
                                            <th>ACTIONS</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data will be loaded here from database -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- AI Risk Dashboard -->
                    <div class="chart-card" style="margin-top: 30px;">
                        <h3>üìä AI Risk Prediction Dashboard</h3>
                        <p>Based on your last 30 days of mood & journal data</p>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px;">
                            <div style="background: var(--dark-bg); padding: 15px; border-radius: 8px;">
                                <p style="color: var(--text-secondary); font-size: 13px;">Depression Risk</p>
                                <p style="font-size: 24px; font-weight: bold; color: #10B981;">Low</p>
                            </div>
                            <div style="background: var(--dark-bg); padding: 15px; border-radius: 8px;">
                                <p style="color: var(--text-secondary); font-size: 13px;">Anxiety Risk</p>
                                <p style="font-size: 24px; font-weight: bold; color: #D946EF;">Medium</p>
                            </div>
                            <div style="background: var(--dark-bg); padding: 15px; border-radius: 8px;">
                                <p style="color: var(--text-secondary); font-size: 13px;">Burnout Risk</p>
                                <p style="font-size: 24px; font-weight: bold; color: #06B6D4;">Low</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ===== PATIENT - RECOMMENDATIONS ===== -->
                <div id="recommendations" class="content-section">
                    <h2>Personalized Mental Health Recommendations</h2>
                    
                    <!-- Personalization Header -->
                    <div style="background: linear-gradient(90deg, rgba(217, 70, 239, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <p style="color: var(--text-primary); margin-bottom: 5px;">
                            <strong>üìä Based on your recent data:</strong> 
                            Avg. Mood: <span id="avg-mood-display">4.1/5</span> ‚Ä¢ 
                            Avg. Stress: <span id="avg-stress-display">2.8/5</span> ‚Ä¢ 
                            Avg. Sleep: <span id="avg-sleep-display">7.6 hrs</span>
                        </p>
                        <p style="color: var(--text-secondary); font-size: 14px;">
                            These recommendations update based on your daily logs and AI analysis.
                        </p>
                    </div>

                    <!-- Dynamic Recommendations Grid -->
                    <div class="recommendations-grid">
                        <!-- Mood-based Recommendation -->
                        <div class="rec-card" id="mood-recommendation">
                            <h4>üé≠ Mood Enhancement</h4>
                            <p id="mood-rec-text">Your mood has been stable. Try gratitude journaling to maintain positivity.</p>
                            <button class="start-btn" onclick="startActivity('mood')">Start Activity</button>
                        </div>
                        
                        <!-- Stress-based Recommendation -->
                        <div class="rec-card" id="stress-recommendation">
                            <h4>üßò Stress Management</h4>
                            <p id="stress-rec-text">Your stress levels are moderate. Practice 5-minute breathing exercises when stressed.</p>
                            <button class="start-btn" onclick="startActivity('stress')">Start Activity</button>
                        </div>
                        
                        <!-- Sleep-based Recommendation -->
                        <div class="rec-card" id="sleep-recommendation">
                            <h4>üò¥ Sleep Improvement</h4>
                            <p id="sleep-rec-text">Your sleep is good. Maintain consistent sleep schedule and avoid screens before bed.</p>
                            <button class="start-btn" onclick="startActivity('sleep')">Start Activity</button>
                        </div>
                        
                        <!-- AI Personalized Suggestion -->
                        <div class="rec-card" style="background: linear-gradient(135deg, rgba(217, 70, 239, 0.15) 0%, rgba(6, 182, 212, 0.15) 100%);">
                            <h4>ü§ñ AI Personal Tip</h4>
                            <p id="ai-personal-tip">Based on your journal analysis, consider talking to a counselor about work stress.</p>
                            <button class="start-btn" onclick="bookCounsellor()">Book Session</button>
                        </div>
                    </div>

                    <!-- RECOMMENDATIONS TABLE - UPDATED TO MATCH DATABASE -->
                    <div class="log-history" style="margin-top: 30px;">
                        <h3>Recommendations</h3>
                        <div class="table-header">
                            <div class="table-title"></div>
                            <div class="header-controls">
                                <button class="add-btn" onclick="openAddModal('recommendations')">+ Add New</button>
                                <input type="text" class="search-input" placeholder="Search..." onkeyup="searchTable('recommendations', this.value)">
                            </div>
                        </div>
                        <div id="recommendations-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Recommendation_ID</th>
                                        <th>Patient_ID</th>
                                        <th>TipCategory</th>
                                        <th>Content</th>
                                        <th>ACTIONS</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be loaded here from database -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ===== PATIENT - COUNSELING ===== -->
                <div id="counseling" class="content-section">
                    <h2>Counseling Sessions</h2>
                    <div class="counseling-section">
                        <h3>Book a Session</h3>
                        <button class="save-btn">Book Session</button>
                        
                        <!-- COUNSELORS TABLE - UPDATED TO MATCH DATABASE -->
                        <h3 style="margin-top: 30px;">Counselors</h3>
                        <div class="table-header">
                            <div class="table-title"></div>
                            <div class="header-controls">
                                <button class="add-btn" onclick="openAddModal('counsellors')">+ Add New</button>
                                <input type="text" class="search-input" placeholder="Search..." onkeyup="searchTable('counsellors', this.value)">
                            </div>
                        </div>
                        <div id="counsellors-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Counsellor_ID</th>
                                        <th>Name</th>
                                        <th>Specialization</th>
                                        <th>Contact</th>
                                        <th>AvailableDay</th>
                                        <th>StartTime</th>
                                        <th>EndTime</th>
                                        <th>ACTIONS</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be loaded here from database -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- SESSIONS TABLE - UPDATED TO MATCH DATABASE -->
                    <div class="log-history" style="margin-top: 30px;">
                        <h3>Sessions</h3>
                        <div class="table-header">
                            <div class="table-title"></div>
                            <div class="header-controls">
                                <button class="add-btn" onclick="openAddModal('sessions')">+ Add New</button>
                                <input type="text" class="search-input" placeholder="Search..." onkeyup="searchTable('sessions', this.value)">
                            </div>
                        </div>
                        <div id="sessions-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Sessions_ID</th>
                                        <th>Patient_ID</th>
                                        <th>Counsellor_ID</th>
                                        <th>Payment_ID</th>
                                        <th>Day</th>
                                        <th>StartTime</th>
                                        <th>EndTime</th>
                                        <th>Notes</th>
                                        <th>ACTIONS</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be loaded here from database -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- FEEDBACK TABLE - UPDATED TO MATCH DATABASE -->
                    <div class="log-history" style="margin-top: 30px;">
                        <h3>Feedback</h3>
                        <div class="table-header">
                            <div class="table-title"></div>
                            <div class="header-controls">
                                <button class="add-btn" onclick="openAddModal('feedback')">+ Add New</button>
                                <input type="text" class="search-input" placeholder="Search..." onkeyup="searchTable('feedback', this.value)">
                            </div>
                        </div>
                        <div id="feedback-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>feedback_ID</th>
                                        <th>Patient_ID</th>
                                        <th>Sessions_ID</th>
                                        <th>Rating</th>
                                        <th>Comments</th>
                                        <th>SubmittedDate</th>
                                        <th>ACTIONS</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be loaded here from database -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ===== PATIENT - PROGRESS ===== -->
                <div id="progress" class="content-section">
                    <h2>Progress Tracking</h2>
                    
                    <!-- PROGRESS METRICS TABLE - UPDATED TO MATCH DATABASE -->
                    <div class="log-history">
                        <div class="table-header">
                            <div class="table-title">Progress Metrics</div>
                            <div class="header-controls">
                                <button class="add-btn" onclick="openAddModal('progess_metrics')">+ Add New</button>
                                <input type="text" class="search-input" placeholder="Search..." onkeyup="searchTable('progess_metrics', this.value)">
                            </div>
                        </div>
                        <div id="progess_metrics-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Sessions_ID</th>
                                        <th>MetricName</th>
                                        <th>Emotional Stability Score</th>
                                        <th>Anxiety Level Score</th>
                                        <th>Fatigue Score</th>
                                        <th>ACTIONS</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be loaded here from database -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ===== PATIENT - PHARMACY ===== -->
                <div id="pharmacy" class="content-section">
                    <h2>Pharmacy Services</h2>
                    <h3>Your Medications</h3>
                    <div class="med-card">
                        <h4>Sertraline</h4>
                        <p>50mg - Twice daily</p>
                    </div>
                    <h3 style="margin-top: 30px;">Prescription Requests</h3>
                    <button class="save-btn">Request Refill</button>
                </div>

                <!-- ===== PATIENT - CRISIS SUPPORT ===== -->
                <div id="crisis-support" class="content-section">
                    <h2>Crisis Detection & Emergency Support</h2>
                    
                    <!-- AI Crisis Detection Alert -->
                    <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(217, 70, 239, 0.1) 100%); border: 1px solid #EF4444; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #EF4444; margin-bottom: 10px;">‚ö†Ô∏è AI Crisis Detection Active</h3>
                        <p style="color: var(--text-primary);">AI monitors your mood logs and journal entries for signs of distress.</p>
                        <p style="color: var(--text-secondary); font-size: 14px; margin-top: 8px;">
                            Last check: <span id="last-check">Today, 10:30 AM</span> ‚Ä¢ Status: <span style="color: #10B981;">Normal</span>
                        </p>
                    </div>

                    <!-- Emergency Contacts -->
                    <div class="crisis-section">
                        <div class="helpline-card">
                            <h3>Emergency Helplines</h3>
                            <p><strong>National Suicide Prevention Lifeline:</strong></p>
                            <p class="phone">1-800-273-8255</p>
                            <p><strong>Crisis Text Line:</strong></p>
                            <p class="phone">Text HOME to 741741</p>
                            <p><strong>Local Emergency:</strong></p>
                            <p class="phone">911</p>
                        </div>
                        
                        <div class="helpline-card">
                            <h3>Your Emergency Contacts</h3>
                            <div id="user-contacts">
                                <p>üë§ <strong>Emergency Contact 1:</strong> John Doe - 123-456-7890</p>
                                <p>üë§ <strong>Emergency Contact 2:</strong> Jane Smith - 098-765-4321</p>
                            </div>
                            <button class="save-btn" style="margin-top: 15px;" onclick="editContacts()">Edit Contacts</button>
                        </div>
                    </div>

                    <!-- Emergency Actions -->
                    <div style="margin-top: 30px;">
                        <h3>Immediate Support</h3>
                        <button class="crisis-btn" onclick="logCrisis('connect_counselor')">üîó Connect with Available Counselor</button>
                        <button class="crisis-btn" style="background: #9333EA;" onclick="logCrisis('emergency_call')">üìû Call Emergency Contact</button>
                        <button class="crisis-btn" style="background: #06B6D4;" onclick="logCrisis('coping_tools')">üõ†Ô∏è Show Coping Tools</button>
                    </div>

                    <!-- CRISIS ALERTS TABLE - UPDATED TO MATCH DATABASE -->
                    <div class="log-history" style="margin-top: 30px;">
                        <h3>Crisis Alerts</h3>
                        <div class="table-header">
                            <div class="table-title">AI-detected and user-initiated alerts</div>
                            <div class="header-controls">
                                <button class="add-btn" onclick="openAddModal('crisisalerts')">+ Add New</button>
                                <input type="text" class="search-input" placeholder="Search..." onkeyup="searchTable('crisisalerts', this.value)">
                                <button class="add-btn" onclick="exportAlerts()">üì• Export Log</button>
                            </div>
                        </div>
                        <div id="crisisalerts-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Alert_ID</th>
                                        <th>Patient_ID</th>
                                        <th>TeamID</th>
                                        <th>Caregiver_ID</th>
                                        <th>AlertTimestamp</th>
                                        <th>Triggers</th>
                                        <th>ACTIONS</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be loaded here from database -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- COUNSELOR DASHBOARD -->
                <div id="counselor-dashboard" style="display: none;">
                    <div class="welcome-card">
                        <h3>Welcome back, Dr. <span id="counselor-name">Sarah Johnson</span>! üë®‚Äç‚öïÔ∏è</h3>
                        <p>Your counseling dashboard for today</p>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <p class="stat-label">ACTIVE PATIENTS</p>
                            <p class="stat-value">9</p>
                        </div>
                        <div class="stat-card">
                            <p class="stat-label">TODAY'S APPOINTMENTS</p>
                            <p class="stat-value">3</p>
                        </div>
                        <div class="stat-card">
                            <p class="stat-label">EMERGENCY ALERTS</p>
                            <p class="stat-value">2</p>
                        </div>
                        <div class="stat-card highlight">
                            <p class="stat-label">SESSIONS COMPLETED</p>
                            <p class="stat-value">80%</p>
                        </div>
                    </div>
                    
                    <!-- COUNSELOR SESSIONS TABLE -->
                    <div class="log-history">
                        <div class="table-header">
                            <div class="table-title">Counselor Sessions</div>
                            <div class="header-controls">
                                <button class="add-btn" onclick="addNewSession()">+ Add Session</button>
                                <input type="text" class="search-input" placeholder="Search patients...">
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Sessions_ID</th>
                                    <th>Patient Name</th>
                                    <th>Date & Time</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Notes</th>
                                    <th>ACTIONS</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>Alex Johnson</td>
                                    <td>Today, 10:00 AM</td>
                                    <td>Video Call</td>
                                    <td>Scheduled</td>
                                    <td>Regular check-in</td>
                                    <td>
                                        <div class="action-icons">
                                            <span class="action-icon" onclick="startSession('1')" title="Start Session">‚ñ∂Ô∏è</span>
                                            <span class="action-icon" onclick="addNote('1')" title="Add Notes">üìù</span>
                                            <span class="action-icon" onclick="rescheduleSession('1')" title="Reschedule">üîÑ</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ===== COUNSELOR - SESSION MANAGEMENT ===== -->
                <div id="counselor-sessions" class="content-section" style="display: none;">
                    <h2>Session Management</h2>
                    
                    <!-- Quick Stats -->
                    <div class="stats-grid" style="margin-bottom: 24px;">
                        <div class="stat-card">
                            <p class="stat-label">Today's Appointments</p>
                            <p class="stat-value">3</p>
                        </div>
                        <div class="stat-card">
                            <p class="stat-label">Pending Follow-ups</p>
                            <p class="stat-value">5</p>
                        </div>
                        <div class="stat-card">
                            <p class="stat-label">Active Patients</p>
                            <p class="stat-value">9</p>
                        </div>
                        <div class="stat-card highlight">
                            <p class="stat-label">Avg. Session Rating</p>
                            <p class="stat-value">4.8 ‚òÖ</p>
                        </div>
                    </div>

                    <!-- Sessions Table -->
                    <div class="log-history">
                        <div class="table-header">
                            <div class="table-title">Counselor Sessions</div>
                            <div class="header-controls">
                                <button class="add-btn" onclick="addNewSession()">+ Add Session</button>
                                <input type="text" class="search-input" placeholder="Search patients...">
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Sessions_ID</th>
                                    <th>Patient Name</th>
                                    <th>Date & Time</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Notes</th>
                                    <th>ACTIONS</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>Alex Johnson</td>
                                    <td>Today, 10:00 AM</td>
                                    <td>Video Call</td>
                                    <td>Scheduled</td>
                                    <td>Regular check-in</td>
                                    <td>
                                        <div class="action-icons">
                                            <span class="action-icon" onclick="startSession('1')" title="Start Session">‚ñ∂Ô∏è</span>
                                            <span class="action-icon" onclick="addNote('1')" title="Add Notes">üìù</span>
                                            <span class="action-icon" onclick="rescheduleSession('1')" title="Reschedule">üîÑ</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ===== ADMIN - USER MANAGEMENT ===== -->
                <div id="user-management" class="content-section">
                    <h2>User Management</h2>
                    <div class="table-header">
                        <div class="table-title"></div>
                        <div class="header-controls">
                            <button class="add-btn">+ Add New</button>
                            <input type="text" class="search-input" placeholder="Search...">
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Patient_ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Age</th>
                                <th>Gender</th>
                                <th>Status</th>
                                <th>ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>John Doe</td>
                                <td>john@bondhu.app</td>
                                <td>25</td>
                                <td>Male</td>
                                <td><span class="status-approved">Active</span></td>
                                <td><div class="action-icons"><span class="action-icon">üëÅÔ∏è</span><span class="action-icon">‚úèÔ∏è</span><span class="action-icon">üóëÔ∏è</span></div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ===== ADMIN - MANAGE COUNSELORS ===== -->
                <div id="manage-counselors" class="content-section">
                    <h2>Manage Counselors</h2>
                    <div class="table-header">
                        <div class="table-title"></div>
                        <div class="header-controls">
                            <button class="add-btn">+ Add New</button>
                            <input type="text" class="search-input" placeholder="Search...">
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Counsellor_ID</th>
                                <th>Name</th>
                                <th>Specialization</th>
                                <th>Contact</th>
                                <th>AvailableDay</th>
                                <th>ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>Dr. Sarah Johnson</td>
                                <td>Anxiety & Stress</td>
                                <td>01766836209</td>
                                <td>2024-11-25</td>
                                <td><div class="action-icons"><span class="action-icon">üëÅÔ∏è</span><span class="action-icon">‚úèÔ∏è</span><span class="action-icon">üóëÔ∏è</span></div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ===== ADMIN - ALL SESSIONS ===== -->
                <div id="all-sessions" class="content-section">
                    <h2>All Sessions</h2>
                    <div class="table-header">
                        <div class="table-title"></div>
                        <div class="header-controls">
                            <button class="add-btn">+ Add New</button>
                            <input type="text" class="search-input" placeholder="Search...">
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Sessions_ID</th>
                                <th>Date</th>
                                <th>Patient Name</th>
                                <th>Counselor Name</th>
                                <th>Status</th>
                                <th>ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>2024-11-20 10:00</td>
                                <td>John Doe</td>
                                <td>Dr. Sarah Johnson</td>
                                <td><span class="status-approved">Completed</span></td>
                                <td><div class="action-icons"><span class="action-icon">üëÅÔ∏è</span><span class="action-icon">‚úèÔ∏è</span><span class="action-icon">üóëÔ∏è</span></div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ===== ADMIN - ALL DAILY LOGS ===== -->
                <div id="all-daily-logs" class="content-section">
                    <h2>All Daily Logs</h2>
                    <div class="table-header">
                        <div class="table-title"></div>
                        <div class="header-controls">
                            <button class="add-btn">+ Add New</button>
                            <input type="text" class="search-input" placeholder="Search...">
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Patient_ID</th>
                                <th>Timestamp</th>
                                <th>Patient Name</th>
                                <th>Mood</th>
                                <th>StressLevel</th>
                                <th>ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>2024-11-18 08:00</td>
                                <td>John Doe</td>
                                <td>Happy</td>
                                <td>2</td>
                                <td><div class="action-icons"><span class="action-icon">üëÅÔ∏è</span><span class="action-icon">‚úèÔ∏è</span><span class="action-icon">üóëÔ∏è</span></div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ===== ADMIN - AI ANALYSIS LOG ===== -->
                <div id="ai-analysis-log" class="content-section">
                    <h2>AI Analysis Log</h2>
                    <div class="table-header">
                        <div class="table-title"></div>
                        <div class="header-controls">
                            <button class="add-btn">+ Add New</button>
                            <input type="text" class="search-input" placeholder="Search...">
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Analysis_ID</th>
                                <th>Patient Name</th>
                                <th>Analysis Date</th>
                                <th>SentimentScore</th>
                                <th>RiskScore</th>
                                <th>ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>John Doe</td>
                                <td>2024-11-18 09:30</td>
                                <td>75</td>
                                <td>25</td>
                                <td><div class="action-icons"><span class="action-icon">üëÅÔ∏è</span><span class="action-icon">‚úèÔ∏è</span><span class="action-icon">üóëÔ∏è</span></div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ===== ADMIN - CONTENT ===== -->
                <div id="content" class="content-section">
                    <h2>Content Management</h2>
                    <div class="table-header">
                        <div class="table-title"></div>
                        <div class="header-controls">
                            <button class="add-btn">+ Add New</button>
                            <input type="text" class="search-input" placeholder="Search...">
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Content ID</th>
                                <th>Title</th>
                                <th>Type</th>
                                <th>Created</th>
                                <th>Status</th>
                                <th>ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>Stress Management Guide</td>
                                <td>Article</td>
                                <td>2024-11-15</td>
                                <td><span class="status-approved">Published</span></td>
                                <td><div class="action-icons"><span class="action-icon">üëÅÔ∏è</span><span class="action-icon">‚úèÔ∏è</span><span class="action-icon">üóëÔ∏è</span></div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ===== ADMIN - CRISIS LOG ===== -->
                <div id="crisis-log" class="content-section">
                    <h2>Crisis Log</h2>
                    <div class="table-header">
                        <div class="table-title"></div>
                        <div class="header-controls">
                            <button class="add-btn">+ Add New</button>
                            <input type="text" class="search-input" placeholder="Search...">
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Alert_ID</th>
                                <th>Patient Name</th>
                                <th>Alert Timestamp</th>
                                <th>Severity</th>
                                <th>Status</th>
                                <th>ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>John Doe</td>
                                <td>2024-11-18 15:45</td>
                                <td>Medium</td>
                                <td><span class="status-approved">Resolved</span></td>
                                <td><div class="action-icons"><span class="action-icon">üëÅÔ∏è</span><span class="action-icon">‚úèÔ∏è</span><span class="action-icon">üóëÔ∏è</span></div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ===== PHARMACIST - PRESCRIPTION QUEUE ===== -->
                <div id="prescription-queue" class="content-section">
                    <h2>Prescription Queue</h2>
                    <div class="table-header">
                        <div class="table-title"></div>
                        <div class="header-controls">
                            <button class="add-btn">+ Add New</button>
                            <input type="text" class="search-input" placeholder="Search...">
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Prescription ID</th>
                                <th>Patient Name</th>
                                <th>Medication</th>
                                <th>Dosage</th>
                                <th>Status</th>
                                <th>ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>John Doe</td>
                                <td>Propranolol</td>
                                <td>10mg</td>
                                <td><span class="status-approved">Approved</span></td>
                                <td><div class="action-icons"><span class="action-icon">üëÅÔ∏è</span><span class="action-icon">‚úèÔ∏è</span><span class="action-icon">üóëÔ∏è</span></div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ===== FINANCE - BILLING DASHBOARD ===== -->
                <div id="billing-dashboard" class="content-section">
                    <h2>Finance Dashboard</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <p class="stat-label">Revenue (Month)</p>
                            <p class="stat-value">$10,560</p>
                        </div>
                        <div class="stat-card highlight">
                            <p class="stat-label">Outstanding Invoices</p>
                            <p class="stat-value">$1,320</p>
                        </div>
                    </div>
                    <h3>Billing Records</h3>
                    <div class="table-header">
                        <div class="table-title"></div>
                        <div class="header-controls">
                            <button class="add-btn">+ Add New</button>
                            <input type="text" class="search-input" placeholder="Search...">
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Payment_ID</th>
                                <th>Patient Name</th>
                                <th>Amount ($)</th>
                                <th>PaymentMethod</th>
                                <th>PaymentDate</th>
                                <th>Status</th>
                                <th>ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>John Doe</td>
                                <td>120</td>
                                <td>Credit Card</td>
                                <td>2024-07-22</td>
                                <td><span class="status-approved">Paid</span></td>
                                <td><div class="action-icons"><span class="action-icon">üëÅÔ∏è</span><span class="action-icon">‚úèÔ∏è</span><span class="action-icon">üóëÔ∏è</span></div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>

    <!-- MODAL FOR ADD/EDIT RECORDS -->
    <div id="crud-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title">Add New Record</h3>
            <form id="record-form">
                <div id="form-fields">
                    <!-- Form fields will be loaded here -->
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
    // ===== DATABASE CRUD FUNCTIONS =====
    let currentTable = '';
    let currentAction = 'add';
    let currentRecordId = null;
    
    // Store column information for each table
    const tableInfo = {};

    // Load table data from database
    async function loadTableData(tableName) {
        try {
            console.log(`Loading table: ${tableName}`);
            const response = await fetch(`table_crud.php?action=read&table=${tableName}`);
            const data = await response.json();
            
            if (data.success) {
                // Store column info
                tableInfo[tableName] = {
                    columns: data.columns,
                    autoIncrementColumns: await getAutoIncrementColumns(tableName)
                };
                updateTableHTML(tableName, data.columns, data.data);
                console.log(`Table ${tableName} loaded successfully with ${data.data.length} records`);
            } else {
                console.error('Error loading table:', data.message);
            }
        } catch (error) {
            console.error('Error loading table:', error);
        }
    }

    // Get auto-increment columns for a table
    async function getAutoIncrementColumns(tableName) {
        try {
            const response = await fetch(`table_crud.php?action=get_auto_increment&table=${tableName}`);
            const data = await response.json();
            return data.success ? data.auto_increment_columns : [];
        } catch (error) {
            console.error('Error getting auto-increment columns:', error);
            return [];
        }
    }

    // Update table HTML with database data - NEW IMPROVED VERSION
    function updateTableHTML(tableName, columns, data) {
        const tableContainer = document.getElementById(`${tableName}-table`);
        if (!tableContainer) {
            console.error(`Table container not found: ${tableName}-table`);
            return;
        }
        
        const tbody = tableContainer.querySelector('tbody');
        if (!tbody) {
            console.error(`Table body not found in: ${tableName}-table`);
            return;
        }
        
        // Clear existing data
        tbody.innerHTML = '';
        
        if (data.length === 0) {
            const tr = document.createElement('tr');
            const td = document.createElement('td');
            td.colSpan = columns.length + 1;
            td.textContent = 'No data available';
            td.style.textAlign = 'center';
            td.style.padding = '20px';
            td.style.color = '#666';
            tr.appendChild(td);
            tbody.appendChild(tr);
            return;
        }
        
        // Sort data by first column (ID) in descending order to show newest first
        data.sort((a, b) => {
            const idA = parseInt(a[columns[0]]) || 0;
            const idB = parseInt(b[columns[0]]) || 0;
            return idB - idA;
        });
        
        data.forEach(row => {
            const tr = document.createElement('tr');
            
            columns.forEach(col => {
                const td = document.createElement('td');
                td.textContent = row[col] || '';
                tr.appendChild(td);
            });
            
            // Add action buttons
            const actionTd = document.createElement('td');
            const idColumn = columns[0];
            const idValue = row[idColumn];
            
            actionTd.innerHTML = `
                <div class="action-icons">
                    <span class="action-icon" onclick="editRecord('${tableName}', '${idColumn}', '${idValue}')" title="Edit">‚úèÔ∏è</span>
                    <span class="action-icon" onclick="deleteRecord('${tableName}', '${idColumn}', '${idValue}')" title="Delete">üóëÔ∏è</span>
                </div>
            `;
            tr.appendChild(actionTd);
            
            tbody.appendChild(tr);
        });
        
        console.log(`Updated table ${tableName} with ${data.length} records`);
    }

    // Open modal for adding/editing records
    async function openAddModal(tableName) {
        currentTable = tableName;
        currentAction = 'add';
        currentRecordId = null;
        
        document.getElementById('modal-title').textContent = `Add New ${tableName}`;
        
        try {
            // Get column names and auto-increment info
            const [columnsResponse, autoIncResponse] = await Promise.all([
                fetch(`table_crud.php?action=get_columns&table=${tableName}`),
                fetch(`table_crud.php?action=get_auto_increment&table=${tableName}`)
            ]);
            
            const columnsData = await columnsResponse.json();
            const autoIncData = await autoIncResponse.json();
            
            if (columnsData.success) {
                let formHTML = '';
                const autoIncrementCols = autoIncData.success ? autoIncData.auto_increment_columns : [];
                
                columnsData.columns.forEach(col => {
                    // Skip auto-increment columns (they'll be auto-generated)
                    if (autoIncrementCols.includes(col)) {
                        console.log(`Skipping auto-increment column: ${col}`);
                        return;
                    }
                    
                    // Skip timestamp fields
                    if (col.toLowerCase() === 'timestamp' || 
                        col.toLowerCase().includes('date') || 
                        col.toLowerCase().includes('time')) {
                        return;
                    }
                    
                    formHTML += `
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">${col}:</label>
                        <input type="text" name="${col}" id="${col}" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" placeholder="Enter ${col}">
                    </div>
                    `;
                });
                
                document.getElementById('form-fields').innerHTML = formHTML;
                document.getElementById('crud-modal').style.display = 'flex';
            }
        } catch (error) {
            console.error('Error:', error);
        }
    }

    // Edit record
    async function editRecord(tableName, idColumn, idValue) {
        currentTable = tableName;
        currentAction = 'edit';
        currentRecordId = idValue;
        
        document.getElementById('modal-title').textContent = `Edit ${tableName} Record`;
        
        try {
            // Get column names and auto-increment info
            const [columnsResponse, autoIncResponse, recordResponse] = await Promise.all([
                fetch(`table_crud.php?action=get_columns&table=${tableName}`),
                fetch(`table_crud.php?action=get_auto_increment&table=${tableName}`),
                fetch(`table_crud.php?action=get_record&table=${tableName}&id=${idValue}`)
            ]);
            
            const columnsData = await columnsResponse.json();
            const autoIncData = await autoIncResponse.json();
            const recordData = await recordResponse.json();
            
            if (columnsData.success) {
                let formHTML = '';
                const autoIncrementCols = autoIncData.success ? autoIncData.auto_increment_columns : [];
                
                columnsData.columns.forEach(col => {
                    // Skip auto-increment columns
                    if (autoIncrementCols.includes(col)) {
                        return;
                    }
                    
                    formHTML += `
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">${col}:</label>
                        <input type="text" name="${col}" id="${col}" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" placeholder="Enter ${col}">
                    </div>
                    `;
                });
                
                document.getElementById('form-fields').innerHTML = formHTML;
                
                // Fill form with existing data
                if (recordData.success && recordData.data.length > 0) {
                    const record = recordData.data[0];
                    columnsData.columns.forEach(col => {
                        const input = document.getElementById(col);
                        if (input && record[col] !== undefined && !autoIncrementCols.includes(col)) {
                            input.value = record[col];
                        }
                    });
                }
                
                document.getElementById('crud-modal').style.display = 'flex';
            }
        } catch (error) {
            console.error('Error:', error);
        }
    }

    // Save record (add or edit) - IMPROVED VERSION
    document.getElementById('record-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const submitBtn = this.querySelector('.btn-primary');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Saving...';
        
        const formData = new FormData();
        formData.append('action', currentAction);
        formData.append('table', currentTable);
        
        if (currentAction === 'edit') {
            formData.append('id', currentRecordId);
        }
        
        // Get all form values
        const inputs = document.querySelectorAll('#form-fields input, #form-fields textarea, #form-fields select');
        inputs.forEach(input => {
            if (input.value.trim() !== '') {
                formData.append(input.name, input.value);
            }
        });
        
        console.log(`Saving to table: ${currentTable}, action: ${currentAction}`);
        
        try {
            const response = await fetch('table_crud.php', {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            if (data.success) {
                alert('Record saved successfully!');
                closeModal();
                // Immediately reload the table data
                await loadTableData(currentTable);
                console.log(`Table ${currentTable} reloaded after save`);
            } else {
                alert('Error: ' + data.message);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error saving record: ' + error.message);
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Save';
        }
    });

    // Delete record - IMPROVED VERSION
    async function deleteRecord(tableName, idColumn, idValue) {
        if (!confirm('Are you sure you want to delete this record?')) {
            return;
        }
        
        console.log(`Deleting from ${tableName}: ${idColumn} = ${idValue}`);
        
        const formData = new FormData();
        formData.append('action', 'delete');
        formData.append('table', tableName);
        formData.append('id', idValue);
        formData.append('id_column', idColumn);
        
        try {
            const response = await fetch('table_crud.php', {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            if (data.success) {
                alert('Record deleted successfully!');
                // Immediately reload the table data
                await loadTableData(tableName);
                console.log(`Table ${tableName} reloaded after delete`);
            } else {
                alert('Error: ' + data.message);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error deleting record');
        }
    }

    // Search table
    async function searchTable(tableName, searchTerm) {
        try {
            const response = await fetch(`table_crud.php?action=search&table=${tableName}&search=${encodeURIComponent(searchTerm)}`);
            const data = await response.json();
            
            if (data.success) {
                updateTableHTML(tableName, data.columns, data.data);
            }
        } catch (error) {
            console.error('Error searching:', error);
        }
    }

    // Close modal
    function closeModal() {
        document.getElementById('crud-modal').style.display = 'none';
        document.getElementById('record-form').reset();
        currentTable = '';
        currentRecordId = null;
    }

    // ===== ORIGINAL FUNCTIONS (UNCHANGED) =====
    function analyzeJournal() {
        const journalText = document.getElementById('journal-entry').value;
        if (!journalText.trim()) {
            alert('Please write something in your journal.');
            return;
        }
        
        document.getElementById('detected-emotion').textContent = 'Anxious';
        document.getElementById('risk-score').textContent = 'Medium (65/100)';
        document.getElementById('keywords').textContent = 'work, overwhelmed, tired, deadline';
        document.getElementById('ai-insight').textContent = 'Your writing shows work-related anxiety. Consider breaking tasks into smaller steps.';
        
        document.getElementById('ai-results').style.display = 'block';
    }

    function askAI() {
        const question = document.getElementById('user-question').value;
        if (!question.trim()) {
            alert('Please enter a question.');
            return;
        }
        
        const chatContainer = document.querySelector('.chat-container');
        const userMsg = document.createElement('div');
        userMsg.className = 'chat-message user';
        userMsg.innerHTML = `<strong>You:</strong> ${question}`;
        userMsg.style.background = 'rgba(217, 70, 239, 0.1)';
        userMsg.style.padding = '10px';
        userMsg.style.borderRadius = '8px';
        userMsg.style.marginBottom = '10px';
        chatContainer.appendChild(userMsg);
        
        setTimeout(() => {
            const aiMsg = document.createElement('div');
            aiMsg.className = 'chat-message ai';
            aiMsg.innerHTML = `<strong>AI Assistant:</strong> Based on your question about "${question}", I recommend practicing mindfulness techniques and considering speaking with a counselor if these feelings persist.`;
            aiMsg.style.background = 'rgba(6, 182, 212, 0.1)';
            aiMsg.style.padding = '10px';
            aiMsg.style.borderRadius = '8px';
            aiMsg.style.marginBottom = '10px';
            chatContainer.appendChild(aiMsg);
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }, 1000);
        
        document.getElementById('user-question').value = '';
    }

    function logCrisis(type) {
        const types = {
            'connect_counselor': 'Connected with counselor',
            'emergency_call': 'Emergency call initiated',
            'coping_tools': 'Coping tools accessed'
        };
        
        alert(`Safety action taken: ${types[type]}`);
        
        if (type === 'coping_tools') {
            document.getElementById('coping-tools').style.display = 'block';
        }
    }

    function editContacts() {
        const newContact1 = prompt('Enter Emergency Contact 1 (Name - Phone):', 'John Doe - 123-456-7890');
        const newContact2 = prompt('Enter Emergency Contact 2 (Name - Phone):', 'Jane Smith - 098-765-4321');
        
        if (newContact1 && newContact2) {
            document.getElementById('user-contacts').innerHTML = `
                <p>üë§ <strong>Emergency Contact 1:</strong> ${newContact1}</p>
                <p>üë§ <strong>Emergency Contact 2:</strong> ${newContact2}</p>
            `;
        }
    }

    function exportAlerts() {
        alert('Crisis log exported (simulated for demo)');
    }

    function startActivity(type) {
        const activities = {
            'mood': 'Gratitude Journaling',
            'stress': 'Breathing Exercise',
            'sleep': 'Sleep Hygiene Practice'
        };
        alert(`Starting ${activities[type]} activity...`);
    }

    function bookCounsellor() {
        alert('Redirecting to counselor booking...');
    }
    
    function navigateTo(sectionId) {
        document.querySelectorAll('.content-section').forEach(section => {
            section.classList.remove('active');
        });
        
        document.getElementById(sectionId).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(nav => {
            nav.classList.remove('active');
        });
        
        const targetNav = document.querySelector(`[data-page="${sectionId}"]`);
        if (targetNav) {
            targetNav.classList.add('active');
        }
    }
    
    function logToday() {
        navigateTo('daily-log');
    }
    
    function addNewSession() {
        alert('Adding new session...');
    }
    
    function startSession(sessionId) {
        alert(`Starting session ${sessionId}...`);
    }
    
    function addNote(sessionId) {
        alert(`Adding note to session ${sessionId}...`);
    }
    
    function rescheduleSession(sessionId) {
        alert(`Rescheduling session ${sessionId}...`);
    }

    // ===== LOGIN FUNCTIONS (UNCHANGED) =====
    document.addEventListener('DOMContentLoaded', function() {
        const roleButtons = document.querySelectorAll('.role-btn');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const loginForm = document.getElementById('login-form');
        const loginBtnText = document.getElementById('login-btn-text');
        
        const roleCredentials = {
            'patient': { email: 'patient@bondhu.com', password: '123456' },
            'counselor': { email: 'counselor@bondhu.com', password: '123456' },
            'admin': { email: 'admin@bondhu.com', password: '123456' },
            'pharmacist': { email: 'pharmacist@bondhu.com', password: '123456' },
            'finance': { email: 'finance@bondhu.com', password: '123456' }
        };
        
        if (roleButtons.length > 0) {
            roleButtons[0].classList.add('active');
            autoFillCredentials('patient');
        }
        
        roleButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                roleButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const role = this.dataset.role;
                autoFillCredentials(role);
            });
        });
        
        function autoFillCredentials(role) {
            if (roleCredentials[role]) {
                emailInput.value = roleCredentials[role].email;
                passwordInput.value = roleCredentials[role].password;
                loginBtnText.textContent = `Sign in as ${role.toUpperCase()}`;
            }
        }
        
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = emailInput.value;
            const password = passwordInput.value;
            
            const activeRoleBtn = document.querySelector('.role-btn.active');
            const role = activeRoleBtn ? activeRoleBtn.dataset.role : 'patient';
            
            let isValid = false;
            for (const [r, creds] of Object.entries(roleCredentials)) {
                if (email === creds.email && password === creds.password) {
                    isValid = true;
                    break;
                }
            }
            
            if (isValid) {
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('dashboard-page').style.display = 'block';
                
                const username = email.split('@')[0];
                document.getElementById('user-greeting').textContent = `Welcome, ${username}`;
                
                showUserFeatures(role);
                showDashboard(role);
                
                // Load all table data after login
                setTimeout(() => {
                    const tables = ['patient', 'dailylogs', 'aianalysis', 'counsellors', 'sessions', 'feedback', 
                                   'payment', 'recommendations', 'progess_metrics', 'crisisalerts', 
                                   'caregiver', 'emergencysosteam', 'patient_preference'];
                    
                    console.log('Loading tables after login...');
                    tables.forEach(table => {
                        loadTableData(table);
                    });
                }, 100);
            } else {
                alert('Invalid credentials. Use the auto-fill buttons for demo access.');
            }
        });
        
        // Navigation
        const navItems = document.querySelectorAll('.nav-item');
        const contentSections = document.querySelectorAll('.content-section');
        
        navItems.forEach(item => {
            item.addEventListener('click', function() {
                const targetPage = this.dataset.page;
                
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
                
                contentSections.forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(targetPage).classList.add('active');
            });
        });
        
        // Logout
        document.getElementById('logout-btn').addEventListener('click', logout);
        document.getElementById('logout-btn-sidebar').addEventListener('click', logout);
        
        function logout() {
            document.getElementById('dashboard-page').style.display = 'none';
            document.getElementById('login-page').style.display = 'block';
            
            emailInput.value = '';
            passwordInput.value = '';
            
            roleButtons.forEach(b => b.classList.remove('active'));
            if (roleButtons.length > 0) {
                roleButtons[0].classList.add('active');
                autoFillCredentials('patient');
            }
        }
        
        function showUserFeatures(userType) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.style.display = 'none';
            });
            
            const dashboardBtn = document.querySelector('[data-page="dashboard"]');
            if (dashboardBtn) {
                dashboardBtn.style.display = 'flex';
                dashboardBtn.classList.add('active');
            }
            
            document.getElementById('logout-btn-sidebar').style.display = 'block';
            
            const features = {
                'patient': [
                    'daily-log', 'ai-analysis', 'recommendations',
                    'counseling', 'progress', 'pharmacy', 'crisis-support'
                ],
                'counselor': ['counselor-sessions'],
                'admin': [
                    'user-management', 'manage-counselors', 'all-sessions',
                    'all-daily-logs', 'ai-analysis-log', 'content', 'crisis-log'
                ],
                'pharmacist': ['prescription-queue'],
                'finance': ['billing-dashboard']
            };
            
            if (features[userType]) {
                features[userType].forEach(feature => {
                    const btn = document.querySelector(`[data-page="${feature}"]`);
                    if (btn) btn.style.display = 'flex';
                });
            }
        }
        
        function showDashboard(userType) {
            document.getElementById('patient-dashboard').style.display = 'none';
            document.getElementById('admin-dashboard').style.display = 'none';
            document.getElementById('pharmacist-dashboard').style.display = 'none';
            document.getElementById('finance-dashboard').style.display = 'none';
            document.getElementById('counselor-dashboard').style.display = 'none';
            
            switch(userType) {
                case 'patient':
                    document.getElementById('patient-dashboard').style.display = 'block';
                    break;
                case 'admin':
                    document.getElementById('admin-dashboard').style.display = 'block';
                    break;
                case 'pharmacist':
                    document.getElementById('pharmacist-dashboard').style.display = 'block';
                    break;
                case 'finance':
                    document.getElementById('finance-dashboard').style.display = 'block';
                    break;
                case 'counselor':
                    document.getElementById('counselor-dashboard').style.display = 'block';
                    break;
            }
        }
    });
    </script>
</body>
</html>